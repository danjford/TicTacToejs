<!DOCTYPE html>
<html>
<head>
  <title>TicTacToe in JavaScript</title>
  <style type="text/css">

    html, body {
      font-family: Arial;
      margin: 0;
      padding: 0;
      background-color: #FAF8EF;
      text-align: center;
    }

    table {
      border-collapse: collapse;
      border: 4px solid #374047;
      margin: 50px auto;
      margin-top: 40px;
    }

    table td {
      padding: 15px 20px;
      border: 2px solid #374047;
      width: 50px;
      height: 50px;
      text-align: center;
      font-size: 20px;
      background-color: white;
      cursor: pointer;
    }

    table td:hover {
      cursor: pointer;
      background-color: rgba(255, 255, 255, 0.2);
    }

    .overlay {
      padding-top: 40px;
    }

  </style>
</head>
<body>

  <div id="container">

    <div class="overlay"></div>

    <table>
      <tr>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    </table>

    <button>Restart Game</button>

  </div>


  <script id='main' type='text/ractive'>

    {{#if winner}}
      <div class="overlay">The winner is {{winner}}.</div>
    {{elseif stalemate}}
      <div class="overlay">Draw.</div>
    {{else}}
      <div class="overlay"></div>
    {{/if}}

    <table>
      <tr>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 1">{{#if board[0][0] === -1}}X{{elseif board[0][0] === 1}}O{{/if}}</td>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 2">{{#if board[0][1] === -1}}X{{elseif board[0][1] === 1}}O{{/if}}</td>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 3">{{#if board[0][2] === -1}}X{{elseif board[0][2] === 1}}O{{/if}}</td>
      </tr>
      <tr>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 4">{{#if board[1][0] === -1}}X{{elseif board[1][0] === 1}}O{{/if}}</td>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 5">{{#if board[1][1] === -1}}X{{elseif board[1][1] === 1}}O{{/if}}</td>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 6">{{#if board[1][2] === -1}}X{{elseif board[1][2] === 1}}O{{/if}}</td>
      </tr>
      <tr>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 7">{{#if board[2][0] === -1}}X{{elseif board[2][0] === 1}}O{{/if}}</td>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 8">{{#if board[2][1] === -1}}X{{elseif board[2][1] === 1}}O{{/if}}</td>
        <td class="{{#if currentPlayer === 0}}current-x{{else}}current-o{{/if}}" on-click="setPlayer: {{currentPlayer}}, 9">{{#if board[2][2] === -1}}X{{elseif board[2][2] === 1}}O{{/if}}</td>
      </tr>
    </table>

    <button on-click="restartGame">Restart Game</button>

  </script>

  <script type="text/javascript" src='http://cdn.ractivejs.org/latest/ractive.js'></script>
  <script type="text/javascript" src="demo/board.js"></script>
  <script type="text/javascript" src="demo/player.js"></script>
  <script type="text/javascript" src="demo/agent.js"></script>

  <script type="text/javascript">

    var board = new Board(),
      player1 = new Player('X'),
      player2 = new Agent('O');

    var ractive = new Ractive({
      el: '#container',
      template: '#main',
      data: { currentPlayer: 0, board: board.getBoard(), winner: false }
    });

    ractive.on('setPlayer', function(target, player, position) {

      var _this = this;

      if(this.get('winner')) return;

      var currentPlayer = this.get('currentPlayer');

      player1.createMove(board, position).then(function() {

        _this.set('board', board.getBoard());
        _this.set('currentPlayer', currentPlayer === 1 ? 0 : 1);
        _this.fire('agentMove');

      });

    });

    ractive.on('agentMove', function() {

      if(this.get('winner')) return;

      var currentPlayer = this.get('currentPlayer');

      player2.createMove(board);

      this.set('board', board.getBoard());
      this.set('currentPlayer', currentPlayer === 0 ? 1 : 0);

    });

    ractive.on('restartGame', function() {
      board = new Board();
      this.set('board', board.getBoard());
      this.set('currentPlayer', 0);
    });



    ractive.observe('board', function() {

      this.set('winner', board.getWinner());

      this.set('stalemate', board.staleMate());

    });


  </script>

</body>
</html>
